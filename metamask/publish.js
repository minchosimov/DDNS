var Web3 = require("web3");
var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:9545"));

var acc = web3.eth.accounts[0]; //get the first account

//Store this contract's compiled bytecode and ABI
var abi = [
	{
		"constant": true,
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "newIp",
				"type": "bytes4"
			}
		],
		"name": "edit",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getExpDateDomain",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferDomain",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getIP",
		"outputs": [
			{
				"name": "",
				"type": "bytes4"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "ip",
				"type": "bytes4"
			}
		],
		"name": "register",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "account",
				"type": "address"
			}
		],
		"name": "getReceipts",
		"outputs": [
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"payable": true,
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "ipAddress",
				"type": "bytes4"
			},
			{
				"indexed": false,
				"name": "expires",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "domainOwner",
				"type": "address"
			}
		],
		"name": "RegisterDomain",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "oldIp",
				"type": "bytes4"
			},
			{
				"indexed": false,
				"name": "newIp",
				"type": "bytes4"
			}
		],
		"name": "ChangeDomainIp",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "oldOwnew",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "TransferDomain",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "WithdrawFromContract",
		"type": "event"
	}
];

var bytecode = "606060405260008054600160a060020a033316600160a060020a0319909116179055611393806100306000396000f30060606040526004361061007f5763ffffffff60e060020a60003504166312065fe081146100815780631673f008146100a65780633ccfd60b146101035780635936cc1c146101165780636b4dd158146101675780639df35ba7146101b8578063b21659f214610214578063efacd29414610282578063f2702127146102d4575b005b341561008c57600080fd5b6100946103d1565b60405190815260200160405180910390f35b34156100b157600080fd5b61007f60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965050509235600160e060020a03191692506103fd915050565b341561010e57600080fd5b61007f610624565b341561012157600080fd5b61009460046024813581810190830135806020601f820181900481020160405190810160405281815292919060208401838380828437509496506106e695505050505050565b341561017257600080fd5b61009460046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965061075895505050505050565b34156101c357600080fd5b61007f60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965050509235600160a060020a03169250610888915050565b341561021f57600080fd5b61026560046024813581810190830135806020601f82018190048102016040519081016040528181529291906020840183838082843750949650610ac695505050505050565b604051600160e060020a0319909116815260200160405180910390f35b61007f60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284375094965050509235600160e060020a0319169250610b3b915050565b34156102df57600080fd5b6102f3600160a060020a0360043516611117565b60405180806020018060200180602001848103845287818151815260200191508051906020019060200280838360005b8381101561033b578082015183820152602001610323565b50505050905001848103835286818151815260200191508051906020019060200280838360005b8381101561037a578082015183820152602001610362565b50505050905001848103825285818151815260200191508051906020019060200280838360005b838110156103b95780820151838201526020016103a1565b50505050905001965050505050505060405180910390f35b6000805433600160a060020a039081169116146103ed57600080fd5b50600160a060020a033016315b90565b8133600160a060020a03166001826040518082805190602001908083835b6020831061043a5780518252601f19909201916020918201910161041b565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03161461048257600080fd5b7ec0ae2d4a222fb82a4d57cd6679deaedb151ad2f263a60aade1e4a2a34ddf18836002856040518082805190602001908083835b602083106104d55780518252601f1990920191602091820191016104b6565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390205460e060020a0284604051600160e060020a031980841660208301528216604082015260608082528190810185818151815260200191508051906020019080838360005b8381101561056557808201518382015260200161054d565b50505050905090810190601f1680156105925780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a1816002846040518082805190602001908083835b602083106105d45780518252601f1990920191602091820191016105b5565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805463ffffffff191660e060020a909204919091179055505050565b60005433600160a060020a0390811691161461063f57600080fd5b6000600160a060020a033016311161065657600080fd5b6000547f2b90f6c1c56fec17c5c8e2057541f2dee6d6262cbff15d1ef0f63281ef5fe22390600160a060020a0390811690301631604051600160a060020a03909216825260208201526040908101905180910390a1600054600160a060020a039081169030163180156108fc0290604051600060405180830381858888f1935050505015156106e457600080fd5b565b60006003826040518082805190602001908083835b6020831061071a5780518252601f1990920191602091820191016106fb565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600201549050919050565b6000805b60028351038110156108765782818151811061077457fe5b016020015160f860020a900460f860020a02600160f860020a0319167f7300000000000000000000000000000000000000000000000000000000000000141561086e578281600101815181106107c657fe5b016020015160f860020a900460f860020a02600160f860020a0319167f6500000000000000000000000000000000000000000000000000000000000000148015610859575082816002018151811061081a57fe5b016020015160f860020a900460f860020a02600160f860020a0319167f7800000000000000000000000000000000000000000000000000000000000000145b1561086e576714d1120d7b1600009150610882565b60010161075c565b670de0b6b3a764000091505b50919050565b8133600160a060020a03166001826040518082805190602001908083835b602083106108c55780518252601f1990920191602091820191016108a6565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03161461090d57600080fd5b7f9235363b7f12d5f72b35e3cec819281f6e889bee6b950099de17a083698605b9836001856040518082805190602001908083835b602083106109615780518252601f199092019160209182019101610942565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a031684604051600160a060020a0380841660208301528216604082015260608082528190810185818151815260200191508051906020019080838360005b838110156109f35780820151838201526020016109db565b50505050905090810190601f168015610a205780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a1816001846040518082805190602001908083835b60208310610a625780518252601f199092019160209182019101610a43565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055505050565b60006002826040518082805190602001908083835b60208310610afa5780518252601f199092019160209182019101610adb565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390205460e060020a0292915050565b600080610b466112d7565b600085600581511015610b5857600080fd5b86610b6281610758565b341015610b6e57600080fd5b4295503392506003886040518082805190602001908083835b60208310610ba65780518252601f199092019160209182019101610b87565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001015460001480610c525750426003896040518082805190602001908083835b60208310610c195780518252601f199092019160209182019101610bfa565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020154105b15610e6757826001896040518082805190602001908083835b60208310610c8a5780518252601f199092019160209182019101610c6b565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055866002896040518082805190602001908083835b60208310610d1c5780518252601f199092019160209182019101610cfd565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051908190039020805463ffffffff191660e060020a9092049190911790556301e1338086019450606060405190810160405280348152602001878152602001868152509350836003896040518082805190602001908083835b60208310610dc15780518252601f199092019160209182019101610da2565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390208151815560208201518160010155604082015160029091015550600160a060020a0383166000908152600460205260409020805460018101610e3783826112f9565b60009283526020909220869160030201815181556020820151816001015560408201518160020155505050611049565b6001886040518082805190602001908083835b60208310610e995780518252601f199092019160209182019101610e7a565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405190819003902054600160a060020a03848116911614610ee557600080fd5b6003886040518082805190602001908083835b60208310610f175780518252601f199092019160209182019101610ef8565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600201546301e13380019450606060405190810160405280348152602001878152602001868152509350836003896040518082805190602001908083835b60208310610fa75780518252601f199092019160209182019101610f88565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040519081900390208151815560208201518160010155604082015160029091015550600160a060020a038316600090815260046020526040902080546001810161101d83826112f9565b600092835260209092208691600302018151815560208201518160010155604082015181600201555050505b7f833afbd2b3d9d7714a533f0c103e8f898b6da0155a9eeb24460b44930a8c0cce88888786604051600160e060020a03198416602082015260408101839052600160a060020a038216606082015260808082528190810186818151815260200191508051906020019080838360005b838110156110d05780820151838201526020016110b8565b50505050905090810190601f1680156110fd5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a15050505050505050565b61111f61132a565b61112761132a565b61112f61132a565b600061113961132a565b61114161132a565b61114961132a565b600160a060020a0388166000908152600460205260408082205495508590518059106111725750595b90808252806020026020018201604052509350846040518059106111935750595b90808252806020026020018201604052509250846040518059106111b45750595b90808252806020026020018201604052509150600090505b848110156112c857600160a060020a03891660009081526004602052604090208054829081106111f857fe5b90600052602060002090600302016000015484828151811061121657fe5b6020908102909101810191909152600160a060020a038a16600090815260049091526040902080548290811061124857fe5b90600052602060002090600302016001015483828151811061126657fe5b6020908102909101810191909152600160a060020a038a16600090815260049091526040902080548290811061129857fe5b9060005260206000209060030201600201548282815181106112b657fe5b602090810290910101526001016111cc565b50919790965090945092505050565b6060604051908101604052806000815260200160008152602001600081525090565b81548183558181151161132557600302816003028360005260206000209182019101611325919061133c565b505050565b60206040519081016040526000815290565b6103fa91905b80821115611363576000808255600182018190556002820155600301611342565b50905600a165627a7a72305820a7969e2e759262a7118250e463a9302b9f74f7034c53e91dde5597859212ebc30029";

//create the contract instance. We can use this instance to publish or connect to a published contract
var Contract = web3.eth.contract(abi);

//create a JS Object (key-value pairs), holding the data we need to publish our contract
var publishData = {
	"from": acc, //the account from which it will be published
	"data": bytecode,
	"gas": 3000000 //gas limit. This should be the same or lower than Ethereum's gas limit
}

//publish the contract, passing a callback that will be called twice. Once when the transaction is sent, and once when it is mined
//the first argument is the constructor argument
Contract.new(publishData, function(err, contractInstance) {
	if(!err) {
		if(contractInstance.address) { //if the contract has an address aka if the transaction is mined
			console.log("New contract address is :", contractInstance.address);
		}
	} else {
		console.error(err); //something went wrong
	}
});
