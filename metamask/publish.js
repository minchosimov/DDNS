var Web3 = require("web3");
var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:9545"));

var acc = web3.eth.accounts[0]; //get the first account

//Store this contract's compiled bytecode and ABI
var abi = [
	{
		"constant": true,
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "newIp",
				"type": "bytes4"
			}
		],
		"name": "edit",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getExpDateDomain",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferDomain",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			}
		],
		"name": "getIP",
		"outputs": [
			{
				"name": "",
				"type": "bytes4"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "domain",
				"type": "bytes"
			},
			{
				"name": "ip",
				"type": "bytes4"
			}
		],
		"name": "register",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "account",
				"type": "address"
			}
		],
		"name": "getReceipts",
		"outputs": [
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			},
			{
				"name": "",
				"type": "uint256[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"payable": true,
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "ipAddress",
				"type": "bytes4"
			},
			{
				"indexed": false,
				"name": "expires",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "domainOwner",
				"type": "address"
			}
		],
		"name": "RegisterDomain",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "oldIp",
				"type": "bytes4"
			},
			{
				"indexed": false,
				"name": "newIp",
				"type": "bytes4"
			}
		],
		"name": "ChangeDomainIp",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "domain",
				"type": "bytes"
			},
			{
				"indexed": false,
				"name": "oldOwnew",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "TransferDomain",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "WithdrawFromContract",
		"type": "event"
	}
];

var bytecode = "6060604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550612086806100536000396000f300606060405260043610610099576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806312065fe01461009b5780631673f008146100c45780633ccfd60b146101495780635936cc1c1461015e5780636b4dd158146101cf5780639df35ba714610240578063b21659f2146102bc578063efacd2941461036b578063f2702127146103e5575b005b34156100a657600080fd5b6100ae610503565b6040518082815260200191505060405180910390f35b34156100cf57600080fd5b610147600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080357bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191690602001909190505061057d565b005b341561015457600080fd5b61015c61092c565b005b341561016957600080fd5b6101b9600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610aca565b6040518082815260200191505060405180910390f35b34156101da57600080fd5b61022a600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610b42565b6040518082815260200191505060405180910390f35b341561024b57600080fd5b6102ba600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610d75565b005b34156102c757600080fd5b610317600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919050506110fe565b60405180827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916815260200191505060405180910390f35b6103e3600480803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919080357bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191690602001909190505061119f565b005b34156103f057600080fd5b61041c600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611d42565b60405180806020018060200180602001848103845287818151815260200191508051906020019060200280838360005b8381101561046757808201518184015260208101905061044c565b50505050905001848103835286818151815260200191508051906020019060200280838360005b838110156104a957808201518184015260208101905061048e565b50505050905001848103825285818151815260200191508051906020019060200280838360005b838110156104eb5780820151818401526020810190506104d0565b50505050905001965050505050505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561056057600080fd5b3073ffffffffffffffffffffffffffffffffffffffff1631905090565b813373ffffffffffffffffffffffffffffffffffffffff166001826040518082805190602001908083835b6020831015156105cd57805182526020820191506020810190506020830392506105a8565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614151561064657600080fd5b426001826040518082805190602001908083835b60208310151561067f578051825260208201915060208101905060208303925061065a565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101541115156106c257600080fd5b7ec0ae2d4a222fb82a4d57cd6679deaedb151ad2f263a60aade1e4a2a34ddf18836001856040518082805190602001908083835b60208310151561071b57805182526020820191506020810190506020830392506106f6565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160149054906101000a90047c010000000000000000000000000000000000000000000000000000000002846040518080602001847bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19168152602001837bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19168152602001828103825285818151815260200191508051906020019080838360005b83811015610844578082015181840152602081019050610829565b50505050905090810190601f1680156108715780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a1816001846040518082805190602001908083835b6020831015156108b95780518252602082019150602081019050602083039250610894565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160146101000a81548163ffffffff02191690837c010000000000000000000000000000000000000000000000000000000090040217905550505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561098757600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff16311115156109ad57600080fd5b7f2b90f6c1c56fec17c5c8e2057541f2dee6d6262cbff15d1ef0f63281ef5fe2236000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1631604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a16000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc3073ffffffffffffffffffffffffffffffffffffffff16319081150290604051600060405180830381858888f193505050501515610ac857600080fd5b565b60006001826040518082805190602001908083835b602083101515610b045780518252602082019150602081019050602083039250610adf565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101549050919050565b600080600090505b6002835103811015610d63577f73000000000000000000000000000000000000000000000000000000000000008382815181101515610b8557fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000027effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19161415610d56577f65000000000000000000000000000000000000000000000000000000000000008360018301815181101515610c2a57fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000027effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148015610d4057507f78000000000000000000000000000000000000000000000000000000000000008360028301815181101515610cd157fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000027effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b15610d55576714d1120d7b1600009150610d6f565b5b8080600101915050610b4a565b670de0b6b3a764000091505b50919050565b813373ffffffffffffffffffffffffffffffffffffffff166001826040518082805190602001908083835b602083101515610dc55780518252602082019150602081019050602083039250610da0565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141515610e3e57600080fd5b426001826040518082805190602001908083835b602083101515610e775780518252602082019150602081019050602083039250610e52565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154111515610eba57600080fd5b7f9235363b7f12d5f72b35e3cec819281f6e889bee6b950099de17a083698605b9836001856040518082805190602001908083835b602083101515610f145780518252602082019150602081019050602083039250610eef565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168460405180806020018473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825285818151815260200191508051906020019080838360005b83811015611010578082015181840152602081019050610ff5565b50505050905090810190601f16801561103d5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a1816001846040518082805190602001908083835b6020831015156110855780518252602082019150602081019050602083039250611060565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050565b60006001826040518082805190602001908083835b6020831015156111385780518252602082019150602081019050602083039250611113565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160149054906101000a90047c0100000000000000000000000000000000000000000000000000000000029050919050565b6000806111aa611fbb565b600085600581511180156111bf5750601e8151105b15156111ca57600080fd5b866111d481610b42565b34101515156111e257600080fd5b87426001826040518082805190602001908083835b60208310151561121c57805182526020820191506020810190506020830392506111f7565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154101561176457429650339350600060018a6040518082805190602001908083835b6020831015156112995780518252602082019150602081019050602083039250611274565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154148061134957504260018a6040518082805190602001908083835b60208310151561131057805182526020820191506020810190506020830392506112eb565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154105b1561135c576301e13380870195506113d4565b6301e1338060018a6040518082805190602001908083835b6020831015156113995780518252602082019150602081019050602083039250611374565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101540195505b6060604051908101604052803481526020018881526020018781525094508360018a6040518082805190602001908083835b60208310151561142b5780518252602082019150602081019050602083039250611406565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508760018a6040518082805190602001908083835b6020831015156114d857805182526020820191506020810190506020830392506114b3565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160146101000a81548163ffffffff02191690837c0100000000000000000000000000000000000000000000000000000000900402179055508560018a6040518082805190602001908083835b60208310151561157f578051825260208201915060208101905060208303925061155a565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010181905550600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020805480600101828161160a9190611fdd565b916000526020600020906003020160008790919091506000820151816000015560208201518160010155604082015181600201555050507f833afbd2b3d9d7714a533f0c103e8f898b6da0155a9eeb24460b44930a8c0cce898988876040518080602001857bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825286818151815260200191508051906020019080838360005b83811015611722578082015181840152602081019050611707565b50505050905090810190601f16801561174f5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a1611d37565b3373ffffffffffffffffffffffffffffffffffffffff166001826040518082805190602001908083835b6020831015156117b3578051825260208201915060208101905060208303925061178e565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415611d3157429650339350600060018a6040518082805190602001908083835b6020831015156118665780518252602082019150602081019050602083039250611841565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154148061191657504260018a6040518082805190602001908083835b6020831015156118dd57805182526020820191506020810190506020830392506118b8565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010154105b15611929576301e13380870195506119a1565b6301e1338060018a6040518082805190602001908083835b6020831015156119665780518252602082019150602081019050602083039250611941565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101540195505b6060604051908101604052803481526020018881526020018781525094508360018a6040518082805190602001908083835b6020831015156119f857805182526020820191506020810190506020830392506119d3565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508760018a6040518082805190602001908083835b602083101515611aa55780518252602082019150602081019050602083039250611a80565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160146101000a81548163ffffffff02191690837c0100000000000000000000000000000000000000000000000000000000900402179055508560018a6040518082805190602001908083835b602083101515611b4c5780518252602082019150602081019050602083039250611b27565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060010181905550600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208054806001018281611bd79190611fdd565b916000526020600020906003020160008790919091506000820151816000015560208201518160010155604082015181600201555050507f833afbd2b3d9d7714a533f0c103e8f898b6da0155a9eeb24460b44930a8c0cce898988876040518080602001857bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681526020018481526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825286818151815260200191508051906020019080838360005b83811015611cef578082015181840152602081019050611cd4565b50505050905090810190601f168015611d1c5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390a1611d36565b600080fd5b5b505050505050505050565b611d4a61200f565b611d5261200f565b611d5a61200f565b6000611d6461200f565b611d6c61200f565b611d7461200f565b6000600260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002080549050945084604051805910611dc95750595b9080825280602002602001820160405250935084604051805910611dea5750595b9080825280602002602001820160405250925084604051805910611e0b5750595b90808252806020026020018201604052509150600090505b84811015611fa657600260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081815481101515611e7757fe5b9060005260206000209060030201600001548482815181101515611e9757fe5b9060200190602002018181525050600260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081815481101515611ef157fe5b9060005260206000209060030201600101548382815181101515611f1157fe5b9060200190602002018181525050600260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081815481101515611f6b57fe5b9060005260206000209060030201600201548282815181101515611f8b57fe5b90602001906020020181815250508080600101915050611e23565b83838397509750975050505050509193909250565b6060604051908101604052806000815260200160008152602001600081525090565b81548183558181151161200a576003028160030283600052602060002091820191016120099190612023565b5b505050565b602060405190810160405280600081525090565b61205791905b80821115612053576000808201600090556001820160009055600282016000905550600301612029565b5090565b905600a165627a7a7230582049cb03ee9fd811d76ac3b8a870eac0395ea366aedbbdcd5c0150dbd5a23cd5070029";

//create the contract instance. We can use this instance to publish or connect to a published contract
var Contract = web3.eth.contract(abi);

//create a JS Object (key-value pairs), holding the data we need to publish our contract
var publishData = {
	"from": acc, //the account from which it will be published
	"data": bytecode,
	"gas": 3000000 //gas limit. This should be the same or lower than Ethereum's gas limit
}

//publish the contract, passing a callback that will be called twice. Once when the transaction is sent, and once when it is mined
//the first argument is the constructor argument
Contract.new(publishData, function(err, contractInstance) {
	if(!err) {
		if(contractInstance.address) { //if the contract has an address aka if the transaction is mined
			console.log("New contract address is :", contractInstance.address);
		}
	} else {
		console.error(err); //something went wrong
	}
});
